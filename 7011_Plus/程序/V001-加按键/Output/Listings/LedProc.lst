C51 COMPILER V9.57.0.0   LEDPROC                                                           06/10/2020 11:34:14 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE LEDPROC
OBJECT MODULE PLACED IN ..\Output\Objects\LedProc.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\User\AppCode\ManageLayer\LedProc.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR
                    -(..\User\AppCode\AppLayer;..\User\AppCode\DriverLayer;..\User\AppCode\ManageLayer;..\User\AppCode\WIFILayer;..\User\SysC
                    -ode\Core) DEBUG OBJECTEXTEND PRINT(..\Output\Listings\LedProc.lst) OBJECT(..\Output\Objects\LedProc.obj)

line level    source

   1          #include "LedProc.h"
   2          #include "TypeDef.h"
   3          #include "SysDataDef.h"
   4          
   5          LED_DEF Led;
   6          UI16 LedFlashTim = 150;
   7          
   8          //共阴
   9          UI08 code LedCodeTab[] = { 
  10          0x00,           // 0 灭
  11          0x28,           // 1  1
  12          0xB6,           // 2  2
  13          0xBA,           // 3  3
  14          0x78,           // 4  4
  15          0xDA,           // 5  5
  16          0xDE,           // 6  6
  17          0xA8,           // 7  7
  18          0xFF,           // 8  8
  19          0xFB,           // 9  9
  20          0x7d,           // 10 H
  21          0xFD,           // 11 A
  22          0x5F,           // 12 b
  23          0xC7,           // 13 c
  24          0x3F,           // 14 d
  25          0xD7,           // 15 E
  26          0xD5,           // 16 F
  27          0x46,           // 17 L
  28          0xf5,           // 18 P
  29          0x6f,           // 19 U
  30          0xEF,           // 20 0
  31          0x10            // 21 -
  32          };
  33                          
  34                          
  35          /*********************************************************************************************************
  36          ** 函数名称: HC595SendData
  37          ** 功能描述: 向SPI总线发送数据
  38          *********************************************************************************************************/
  39          void HC595SendData(u8 SendVal)
  40          {  
  41   1              u8 i;
  42   1              
  43   1              for(i=0;i<8;i++) 
  44   1              {
  45   2                      if((SendVal<<i) & (0x80)) 
  46   2                      {
  47   3                              MOSIO = 1; //set dataline high  0X80  最高位与SendVal左移的最高位 进行逻辑运算
  48   3                      }
  49   2                      else
  50   2                      {
  51   3                              MOSIO = 0;      // 如果为真 MOSIO = 1  
  52   3                      }
  53   2                      
C51 COMPILER V9.57.0.0   LEDPROC                                                           06/10/2020 11:34:14 PAGE 2   

  54   2                      S_CLK=0;
  55   2                      NOP2();
  56   2                      S_CLK=1;        
  57   2              }
  58   1         
  59   1                      R_CK=0; //set dataline low
  60   1                      NOP2();
  61   1                      R_CK=1; //片选
  62   1      }
  63          /********************************************************
  64          函数：Init_Panel()
  65          功能：初始化数组
  66          耗时：
  67          输入：无
  68          输出：无
  69          返回：无
  70          时间：2019/8/5
  71          ********************************************************/
  72          void Init_PanelFlash(void)
  73          {
  74   1          Fls[0] = 0xFF;
  75   1      
  76   1          Led.FlashOn = 0xFF;
  77   1          Led.FlashOff = 0xFF;
  78   1      }
  79          
  80          /********************************************************
  81          函数：LED_ReLedFlash()
  82          功能：LED闪烁更新函数
  83          周期：1ms
  84          耗时：
  85          输入：
  86          输出：无
  87          返回：无
  88          时间：2019/8/5
  89          ********************************************************/
  90          void LED_ReLedFlash(void)
  91          {
  92   1          if(!AllFlashF) return;
  93   1          
  94   1          if((Led.Flag) && (Led.Tim >= LedFlashTim))
  95   1          {
  96   2      
  97   2              Fls[0] |= Led.FlashOn;
  98   2              Led.Tim = 0;
  99   2              Led.Flag = 0;
 100   2          }
 101   1          else if((!(Led.Flag)) && (Led.Tim >= LedFlashTim))
 102   1          {
 103   2              Fls[0] &= Led.FlashOff;
 104   2              Led.Tim = 0;
 105   2              Led.Flag = 1;
 106   2          }
 107   1          
 108   1          Led.Tim++;
 109   1      }
 110          
 111          /********************************************************
 112          函数：LED_SetDigFlash()
 113          功能：设置一个数码管闪烁
 114          周期：无
 115          耗时：
C51 COMPILER V9.57.0.0   LEDPROC                                                           06/10/2020 11:34:14 PAGE 3   

 116          输入：DigNum: 位选地址(0 - 15)
 117                Mode：闪烁模式 (0 - 3)
 118          输出：无
 119          返回：无
 120          时间：2019/8/5
 121          *******************************************************/
 122          void LED_SetFlash(UI08 Mode)
 123          {
 124   1          Led.FlashOn = 0xff; 
 125   1          Led.FlashOff = 0x00;
 126   1          
 127   1          if(Mode == 0)
 128   1              LedFlashTim = 150;
 129   1          else
 130   1              LedFlashTim = 25;    
 131   1      }
 132          
 133          /********************************************************
 134          函数：LED_ClrFlash()
 135          功能：清除一个数码管闪烁
 136          周期：无
 137          耗时：
 138          输入：DigNum: 位选地址(0 - 15)
 139          输出：无
 140          返回：无
 141          时间：2019/8/5
 142          ********************************************************/
 143          void LED_ClrFlash(void)
 144          {
 145   1          Led.FlashOn = 0xff; 
 146   1          Led.FlashOff = 0xff;
 147   1      }
 148          
 149          void LED_ShowProc(void)
 150          {   
 151   1          DigBuf[0]  = Dig[0] & Fls[0];
 152   1              
 153   1          if(DigBuf[0] > 21)  DigBuf[0] = 21;
 154   1          
 155   1          HC595SendData(LedCodeTab[DigBuf[0]]);
 156   1      
 157   1      }
 158          
 159          UI08 LedShowTrans(UI16 Value)
 160          {
 161   1          UI08 show_value = 0;
 162   1          
 163   1          if(Value < LightValTab[Dimmer.MinLightVal][0])
 164   1          {
 165   2              show_value = 0;
 166   2          }
 167   1          else if(Value >= LightValTab[Dimmer.MinLightVal][0] && Value < LightValTab[Dimmer.MinLightVal][1])
 168   1          {
 169   2              show_value = 1;
 170   2          }
 171   1          else if(Value >= LightValTab[Dimmer.MinLightVal][1] && Value < LightValTab[Dimmer.MinLightVal][2])
 172   1          {
 173   2              show_value = 2;
 174   2          }
 175   1          else if(Value >= LightValTab[Dimmer.MinLightVal][2] && Value < LightValTab[Dimmer.MinLightVal][3])
 176   1          {
 177   2              show_value = 3;
C51 COMPILER V9.57.0.0   LEDPROC                                                           06/10/2020 11:34:14 PAGE 4   

 178   2          }
 179   1          else if(Value >= LightValTab[Dimmer.MinLightVal][3] && Value < LightValTab[Dimmer.MinLightVal][4])
 180   1          {
 181   2              show_value = 4;
 182   2          } 
 183   1          else if(Value >= LightValTab[Dimmer.MinLightVal][4] && Value < LightValTab[Dimmer.MinLightVal][5])
 184   1          {
 185   2              show_value = 5;
 186   2          }
 187   1          else if(Value >= LightValTab[Dimmer.MinLightVal][5] && Value < LightValTab[Dimmer.MinLightVal][6])
 188   1          {
 189   2              show_value = 6;
 190   2          }
 191   1          else if(Value >= LightValTab[Dimmer.MinLightVal][6] && Value < LightValTab[Dimmer.MinLightVal][7])
 192   1          {
 193   2              show_value = 7;
 194   2          }
 195   1          else if(Value >= LightValTab[Dimmer.MinLightVal][7] && Value < LightValTab[Dimmer.MinLightVal][8])
 196   1          {
 197   2              show_value = 8;
 198   2          } 
 199   1          else if(Value >= LightValTab[Dimmer.MinLightVal][8] && (Value < LightValTab[Dimmer.MinLightVal][8] + 2
             -2))
 200   1          {
 201   2              show_value = 9;
 202   2          }
 203   1          else if((Value >= LightValTab[Dimmer.MinLightVal][8] + 22))
 204   1          {
 205   2              show_value = 10;
 206   2          }
 207   1      
 208   1          return show_value;
 209   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    951    ----
   CONSTANT SIZE    =     22    ----
   XDATA SIZE       =      7    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
