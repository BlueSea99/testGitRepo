C51 COMPILER V9.57.0.0   MCU_API                                                           05/29/2020 17:28:11 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MCU_API
OBJECT MODULE PLACED IN ..\Output\Objects\mcu_api.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\User\AppCode\WIFILayer\mcu_api.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.
                    -.\User\AppCode\AppLayer;..\User\AppCode\DriverLayer;..\User\AppCode\ManageLayer;..\User\AppCode\WIFILayer;..\User\SysCod
                    -e\Core) DEBUG OBJECTEXTEND PRINT(..\Output\Listings\mcu_api.lst) OBJECT(..\Output\Objects\mcu_api.obj)

line level    source

   1          /****************************************Copyright (c)*************************
   2          **                               ç‰ˆæƒæ‰€æœ‰ (C), 2015-2020,
   3          **
   4          **                                 http://www.tuya.com
   5          **
   6          **--------------æ–‡ä»¶ä¿¡æ¯-------------------------------------------------------
   7          **æ–‡   ä»¶   å: mcu_api.c
   8          **æ        è¿°: ä¸‹å‘/ä¸ŠæŠ¥æ•°æ®å¤„ç†å‡½æ•°
   9          **ä½¿ ç”¨ è¯´ æ˜ : æ­¤æ–‡ä»¶ä¸‹å‡½æ•°æ— é¡»ç”¨æˆ·ä¿®æ”¹,ç”¨æˆ·éœ€è¦è°ƒç”¨çš„æ–‡ä»¶éƒ½åœ¨è¯¥æ–‡ä»¶å†…
  10          **
  11          **
  12          **--------------å½“å‰ç‰ˆæœ¬ä¿®è®¢---------------------------------------------------
  13          ** ç‰ˆ  æœ¬: v2.5.2
  14          ** æ—¥ã€€æœŸ: 2019å¹´7æœˆ5æ—¥
  15          ** æã€€è¿°: 1:å¢åŠ WiFiåŠŸèƒ½æ€§æµ‹è¯•ï¼ˆè¿æ¥æŒ‡å®šè·¯ç”±ï¼‰
  16                     2:ç®€åŒ–æµæœåŠ¡è¿‡ç¨‹ï¼Œç”¨æˆ·åªéœ€è¦è°ƒç”¨æµæœåŠ¡ä¼ è¾“æ¥å£å³å¯ä½¿ç”¨æµæœåŠ¡
  17                     3:å¢åŠ åŒæ­¥ä¸ŠæŠ¥æŒ‡ä»¤
  18                     4:å¢åŠ è·å–å½“å‰wifiè”ç½‘çŠ¶æ€æŒ‡ä»¤
  19                     5:å¢åŠ è·å–æ ¼æ—æ—¶é—´æŒ‡ä»¤
  20                     6:ä¼˜åŒ–otaå‡çº§æµç¨‹ï¼Œå¯åŠ¨otaå‡çº§æ—¶ç”¨æˆ·å¯ä»¥é€‰æ‹©ä¼ è¾“åŒ…å¤§å°
  21                     7:å¢åŠ è·å–æ¨¡å—macåœ°å€æŒ‡ä»¤
  22                     
  23          ** ç‰ˆ  æœ¬: v2.5.1
  24          ** æ—¥ã€€æœŸ: 2018å¹´10æœˆ27æ—¥
  25          ** æã€€è¿°: 1:é»˜è®¤å…³é—­æµæœåŠ¡åŠŸèƒ½
  26                     2:å¢åŠ 03åè®®wifiçŠ¶æ€å®å®šä¹‰
  27                             3:æ›´æ–°ä¸ä¿®æ”¹éƒ¨åˆ†å‡½æ•°æ³¨é‡Š
  28                             
  29          ** ç‰ˆ  æœ¬: v2.5.0
  30          ** æ—¥ã€€æœŸ: 2018å¹´4æœˆ18æ—¥
  31          ** æã€€è¿°: 1:åè®®ç‰ˆæœ¬æ”¹ä¸º0x03
  32                     2:å¢åŠ WIFIæ¨¡ç»„å¿ƒè·³å…³é—­åŠŸèƒ½
  33                     3:å¢åŠ å¤©æ°”åŠŸèƒ½
  34          
  35          ** ç‰ˆ  æœ¬: v2.3.8
  36          ** æ—¥ã€€æœŸ: 2018å¹´1æœˆ17æ—¥
  37          ** æã€€è¿°: 1:å˜é‡æ·»åŠ volatileé˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–
  38                     2:æ·»åŠ #erroræç¤º
  39          
  40          ** ç‰ˆ  æœ¬: v2.3.7
  41          ** æ—¥ã€€æœŸ: 2017å¹´4æœˆ18æ—¥
  42          ** æã€€è¿°: 1:ä¼˜åŒ–ä¸²å£é˜Ÿåˆ—æ¥æ”¶å¤„ç†
  43                             
  44          ** ç‰ˆ  æœ¬: v2.3.6
  45          ** æ—¥ã€€æœŸ: 2016å¹´7æœˆ21æ—¥
  46          ** æã€€è¿°: 1:ä¿®å¤è·å–æœ¬åœ°æ—¶é—´é”™è¯¯
  47                     2:æ·»åŠ hex_to_bcdè½¬æ¢å‡½æ•°
  48                             
  49          ** ç‰ˆ  æœ¬: v2.3.5
  50          ** æ—¥ã€€æœŸ: 2016å¹´6æœˆ3æ—¥
  51          ** æã€€è¿°: 1:ä¿®æ”¹è¿”å›åè®®ç‰ˆæœ¬ä¸º0x01
  52                     2:å›ºä»¶å‡çº§æ•°æ®åç§»é‡ä¿®æ”¹ä¸º4å­—èŠ‚
  53          
C51 COMPILER V9.57.0.0   MCU_API                                                           05/29/2020 17:28:11 PAGE 2   

  54          ** ç‰ˆ  æœ¬: v2.3.4
  55          ** æ—¥ã€€æœŸ: 2016å¹´5æœˆ26æ—¥
  56          ** æã€€è¿°: 1:ä¼˜åŒ–ä¸²å£è§£æå‡½æ•°
  57                     2:ä¼˜åŒ–ç¼–è¯‘å™¨å…¼å®¹æ€§,å–æ¶ˆenumç±»å‹å®šä¹‰
  58          
  59          ** ç‰ˆ  æœ¬: v2.3.3
  60          ** æ—¥ã€€æœŸ: 2016å¹´5æœˆ24æ—¥
  61          ** æã€€è¿°: 1:ä¿®æ”¹mcuè·å–æœ¬åœ°æ—¶é—´å‡½æ•°
  62                     2:æ·»åŠ wifiåŠŸèƒ½æµ‹è¯•
  63          
  64          ** ç‰ˆ  æœ¬: v2.3.2
  65          ** æ—¥ã€€æœŸ: 2016å¹´4æœˆ23æ—¥
  66          ** æã€€è¿°: 1:ä¼˜åŒ–ä¸²å£æ•°æ®è§£æ
  67                     2:ä¼˜åŒ–MCUå›ºä»¶å‡çº§æµç¨‹
  68                     3:ä¼˜åŒ–ä¸ŠæŠ¥æµç¨‹
  69          
  70          ** ç‰ˆ  æœ¬: v2.3.1
  71          ** æ—¥ã€€æœŸ: 2016å¹´4æœˆ15æ—¥
  72          ** æã€€è¿°: 1:ä¼˜åŒ–ä¸²å£æ•°æ®è§£æ
  73          
  74          ** ç‰ˆ  æœ¬: v2.3
  75          ** æ—¥ã€€æœŸ: 2016å¹´4æœˆ14æ—¥
  76          ** æã€€è¿°: 1:æ”¯æŒMCUå›ºä»¶åœ¨çº¿å‡çº§
  77          
  78          ** ç‰ˆ  æœ¬: v2.2
  79          ** æ—¥ã€€æœŸ: 2016å¹´4æœˆ11æ—¥
  80          ** æã€€è¿°: 1:ä¿®æ”¹ä¸²å£æ•°æ®æ¥æ”¶æ–¹å¼
  81          
  82          ** ç‰ˆ  æœ¬: v2.1
  83          ** æ—¥ã€€æœŸ: 2016å¹´4æœˆ8æ—¥
  84          ** æã€€è¿°: 1:åŠ å…¥æŸäº›ç¼–è¯‘å™¨ä¸æ”¯æŒå‡½æ•°æŒ‡é’ˆå…¼å®¹é€‰é¡¹
  85          
  86          ** ç‰ˆ  æœ¬: v2.0
  87          ** æ—¥ã€€æœŸ: 2016å¹´3æœˆ29æ—¥
  88          ** æã€€è¿°: 1:ä¼˜åŒ–ä»£ç ç»“æ„
  89                     2:èŠ‚çœRAMç©ºé—´
  90          **
  91          **-----------------------------------------------------------------------------
  92          ******************************************************************************/
  93          #define MCU_API_GLOBAL
  94          
  95          #include "wifi.h"
  96          
  97          /*****************************************************************************
  98          å‡½æ•°åç§° : hex_to_bcd
  99          åŠŸèƒ½æè¿° : hexè½¬bcd
 100          è¾“å…¥å‚æ•° : Value_H:é«˜å­—èŠ‚/Value_L:ä½å­—èŠ‚
 101          è¿”å›å‚æ•° : bcd_value:è½¬æ¢å®Œæˆåæ•°æ®
 102          *****************************************************************************/
 103          unsigned char hex_to_bcd(unsigned char Value_H,unsigned char Value_L)
 104          {
 105   1        unsigned char bcd_value;
 106   1        
 107   1        if((Value_H >= '0') && (Value_H <= '9'))
 108   1          Value_H -= '0';
 109   1        else if((Value_H >= 'A') && (Value_H <= 'F'))
 110   1          Value_H = Value_H - 'A' + 10;
 111   1        else if((Value_H >= 'a') && (Value_H <= 'f'))
 112   1          Value_H = Value_H - 'a' + 10;
 113   1         
 114   1        bcd_value = Value_H & 0x0f;
 115   1        
C51 COMPILER V9.57.0.0   MCU_API                                                           05/29/2020 17:28:11 PAGE 3   

 116   1        bcd_value <<= 4;
 117   1        if((Value_L >= '0') && (Value_L <= '9'))
 118   1          Value_L -= '0';
 119   1        else if((Value_L >= 'A') && (Value_L <= 'F'))
 120   1          Value_L = Value_L - 'a' + 10;
 121   1        else if((Value_L >= 'a') && (Value_L <= 'f'))
 122   1          Value_L = Value_L - 'a' + 10;
 123   1        
 124   1        bcd_value |= Value_L & 0x0f;
 125   1      
 126   1        return bcd_value;
 127   1      }
 128          /*****************************************************************************
 129          å‡½æ•°åç§° : my_strlen
 130          åŠŸèƒ½æè¿° : æ±‚å­—ç¬¦ä¸²é•¿åº¦
 131          è¾“å…¥å‚æ•° : src:æºåœ°å€
 132          è¿”å›å‚æ•° : len:æ•°æ®é•¿åº¦
 133          *****************************************************************************/
 134          unsigned long my_strlen(unsigned char *str)  
 135          {
 136   1        unsigned long len = 0;
 137   1        if(str == NULL)
 138   1        { 
 139   2          return 0;
 140   2        }
 141   1        
 142   1        for(len = 0; *str ++ != '\0'; )
 143   1        {
 144   2          len ++;
 145   2        }
 146   1        
 147   1        return len;
 148   1      }
 149          /*****************************************************************************
 150          å‡½æ•°åç§° : my_memset
 151          åŠŸèƒ½æè¿° : æŠŠsrcæ‰€æŒ‡å†…å­˜åŒºåŸŸçš„å‰countä¸ªå­—èŠ‚è®¾ç½®æˆå­—ç¬¦c
 152          è¾“å…¥å‚æ•° : src:æºåœ°å€
 153                     ch:è®¾ç½®å­—ç¬¦
 154                     count:è®¾ç½®æ•°æ®é•¿åº¦
 155          è¿”å›å‚æ•° : src:æ•°æ®å¤„ç†å®Œåçš„æºåœ°å€
 156          *****************************************************************************/
 157          void *my_memset(void *src,unsigned char ch,unsigned short count)
 158          {
 159   1        unsigned char *tmp = (unsigned char *)src;
 160   1        
 161   1        if(src == NULL)
 162   1        {
 163   2          return NULL;
 164   2        }
 165   1        
 166   1        while(count --)
 167   1        {
 168   2          *tmp ++ = ch;
 169   2        }
 170   1        
 171   1        return src;
 172   1      }
 173          /*****************************************************************************
 174          å‡½æ•°åç§° : mymemcpy
 175          åŠŸèƒ½æè¿° : å†…å­˜æ‹·è´
 176          è¾“å…¥å‚æ•° : dest:ç›®æ ‡åœ°å€
 177                     src:æºåœ°å€
C51 COMPILER V9.57.0.0   MCU_API                                                           05/29/2020 17:28:11 PAGE 4   

 178                     count:æ•°æ®æ‹·è´æ•°é‡
 179          è¿”å›å‚æ•° : src:æ•°æ®å¤„ç†å®Œåçš„æºåœ°å€
 180          *****************************************************************************/
 181          void *my_memcpy(void *dest, const void *src, unsigned short count)  
 182          {  
 183   1        unsigned char *pdest = (unsigned char *)dest;  
 184   1        const unsigned char *psrc  = (const unsigned char *)src;  
 185   1        unsigned short i;
 186   1        
 187   1        if(dest == NULL || src == NULL)
 188   1        { 
 189   2          return NULL;
 190   2        }
 191   1        
 192   1        if((pdest <= psrc) || (pdest > psrc + count))
 193   1        {  
 194   2          for(i = 0; i < count; i ++)
 195   2          {  
 196   3            pdest[i] = psrc[i];  
 197   3          }  
 198   2        }
 199   1        else
 200   1        {
 201   2          for(i = count; i > 0; i --)
 202   2          {  
 203   3            pdest[i - 1] = psrc[i - 1];  
 204   3          }  
 205   2        }  
 206   1        
 207   1        return dest;  
 208   1      }
 209          /*****************************************************************************
 210          å‡½æ•°åç§° : my_strcpy
 211          åŠŸèƒ½æè¿° : å†…å­˜æ‹·è´
 212          è¾“å…¥å‚æ•° : s1:ç›®æ ‡åœ°å€
 213                     s2:æºåœ°å€
 214          è¿”å›å‚æ•° : æ•°æ®å¤„ç†å®Œåçš„æºåœ°å€
 215          *****************************************************************************/
 216          char *my_strcpy(char *dest, const char *src)  
 217          {
 218   1        char *p = dest;
 219   1        while(*src!='\0')
 220   1        {
 221   2          *dest++ = *src++;
 222   2        }
 223   1        *dest = '\0';
 224   1        return p;
 225   1      }
 226          /*****************************************************************************
 227          å‡½æ•°åç§° : my_strcmp
 228          åŠŸèƒ½æè¿° : å†…å­˜æ‹·è´
 229          è¾“å…¥å‚æ•° : s1:å­—ç¬¦ä¸²1
 230                     s2:å­—ç¬¦ä¸²2
 231          è¿”å›å‚æ•° : å¤§å°æ¯”è¾ƒå€¼ï¼Œ0:s1=s2; -1:s1<s2; 1:s1>s2
 232          *****************************************************************************/
 233          int my_strcmp(char *s1 , char *s2)
 234          {
 235   1        while( *s1 && *s2 && *s1 == *s2 )
 236   1        {
 237   2          s1++;
 238   2          s2++;
 239   2        }
C51 COMPILER V9.57.0.0   MCU_API                                                           05/29/2020 17:28:11 PAGE 5   

 240   1        return *s1 - *s2;
 241   1      }
 242          /*****************************************************************************
 243          å‡½æ•°åç§° : int_to_byte
 244          åŠŸèƒ½æè¿° : å°†intç±»å‹æ‹†åˆ†å››ä¸ªå­—èŠ‚
 245          è¾“å…¥å‚æ•° : number:4å­—èŠ‚åŸæ•°æ®;value:å¤„ç†å®Œæˆå4å­—èŠ‚æ•°æ®
 246          è¿”å›å‚æ•° :æ— 
 247          ****************************************************************************/
 248          void int_to_byte(unsigned long number,unsigned char value[4])
 249          {
 250   1        value[0] = number >> 24;
 251   1        value[1] = number >> 16;
 252   1        value[2] = number >> 8;
 253   1        value[3] = number & 0xff;
 254   1      }
 255          /*****************************************************************************
 256          å‡½æ•°åç§° : byte_to_int
 257          åŠŸèƒ½æè¿° : å°†4å­—èŠ‚åˆå¹¶ä¸º1ä¸ª32bitå˜é‡
 258          è¾“å…¥å‚æ•° : value:4å­—èŠ‚æ•°ç»„
 259          è¿”å›å‚æ•° : number:åˆå¹¶å®Œæˆåçš„32bitå˜é‡
 260          ****************************************************************************/
 261          unsigned long byte_to_int(const unsigned char value[4])
 262          {
 263   1        unsigned long nubmer = 0;
 264   1      
 265   1        nubmer = (unsigned long)value[0];
 266   1        nubmer <<= 8;
 267   1        nubmer |= (unsigned long)value[1];
 268   1        nubmer <<= 8;
 269   1        nubmer |= (unsigned long)value[2];
 270   1        nubmer <<= 8;
 271   1        nubmer |= (unsigned long)value[3];
 272   1        
 273   1        return nubmer;
 274   1      }
 275          #ifndef WIFI_CONTROL_SELF_MODE
 276          /*****************************************************************************
 277          å‡½æ•°åç§° : mcu_get_reset_wifi_flag
 278          åŠŸèƒ½æè¿° : MCUè·å–å¤ä½wifiæˆåŠŸæ ‡å¿—
 279          è¾“å…¥å‚æ•° : æ— 
 280          è¿”å›å‚æ•° : å¤ä½æ ‡å¿—:RESET_WIFI_ERROR:å¤±è´¥/RESET_WIFI_SUCCESS:æˆåŠŸ
 281          ä½¿ç”¨è¯´æ˜ : 1:MCUä¸»åŠ¨è°ƒç”¨mcu_reset_wifi()åè°ƒç”¨è¯¥å‡½æ•°è·å–å¤ä½çŠ¶æ€
 282                     2:å¦‚æœä¸ºæ¨¡å—è‡ªå¤„ç†æ¨¡å¼,MCUæ— é¡»è°ƒç”¨è¯¥å‡½æ•°
 283          *****************************************************************************/
 284          unsigned char mcu_get_reset_wifi_flag(void)
 285          {
 286   1        return reset_wifi_flag;
 287   1      }
 288          /*****************************************************************************
 289          å‡½æ•°åç§° : reset_wifi
 290          åŠŸèƒ½æè¿° : MCUä¸»åŠ¨é‡ç½®wifiå·¥ä½œæ¨¡å¼
 291          è¾“å…¥å‚æ•° : æ— 
 292          è¿”å›å‚æ•° : æ— 
 293          ä½¿ç”¨è¯´æ˜ : 1:MCUä¸»åŠ¨è°ƒç”¨,é€šè¿‡mcu_get_reset_wifi_flag()å‡½æ•°è·å–é‡ç½®wifiæ˜¯å¦æˆåŠŸ
 294                     2:å¦‚æœä¸ºæ¨¡å—è‡ªå¤„ç†æ¨¡å¼,MCUæ— é¡»è°ƒç”¨è¯¥å‡½æ•°
 295          *****************************************************************************/
 296          void mcu_reset_wifi(void)
 297          {
 298   1              extern unsigned char is_read_time;
 299   1              extern unsigned int temp0;
 300   1              
 301   1        reset_wifi_flag = RESET_WIFI_ERROR;
C51 COMPILER V9.57.0.0   MCU_API                                                           05/29/2020 17:28:11 PAGE 6   

 302   1        
 303   1        wifi_uart_write_frame(WIFI_RESET_CMD, 0);
 304   1              
 305   1              is_read_time = 0;  //æ¸…é™¤é…ç½‘æ—¶é—´é™åˆ¶   
 306   1              
 307   1              temp0 = 1898;  // æ¢å¤å‡ºå‚æ•°æ®    
 308   1      }
 309          /*****************************************************************************
 310          å‡½æ•°åç§° : mcu_get_wifimode_flag
 311          åŠŸèƒ½æè¿° : è·å–è®¾ç½®wifiçŠ¶æ€æˆåŠŸæ ‡å¿—
 312          è¾“å…¥å‚æ•° : æ— 
 313          è¿”å›å‚æ•° : SET_WIFICONFIG_ERROR:å¤±è´¥/SET_WIFICONFIG_SUCCESS:æˆåŠŸ
 314          ä½¿ç”¨è¯´æ˜ : 1:MCUä¸»åŠ¨è°ƒç”¨mcu_set_wifi_mode()åè°ƒç”¨è¯¥å‡½æ•°è·å–å¤ä½çŠ¶æ€
 315                     2:å¦‚æœä¸ºæ¨¡å—è‡ªå¤„ç†æ¨¡å¼,MCUæ— é¡»è°ƒç”¨è¯¥å‡½æ•°
 316          *****************************************************************************/
 317          unsigned char mcu_get_wifimode_flag(void)
 318          {
 319   1        return set_wifimode_flag;
 320   1      }
 321          /*****************************************************************************
 322          å‡½æ•°åç§° : mcu_set_wifi_mode
 323          åŠŸèƒ½æè¿° : MCUè®¾ç½®wifiå·¥ä½œæ¨¡å¼
 324          è¾“å…¥å‚æ•° : mode:
 325                    SMART_CONFIG:è¿›å…¥smartconfigæ¨¡å¼
 326                    AP_CONFIG:è¿›å…¥APæ¨¡å¼
 327          è¿”å›å‚æ•° : æ— 
 328          ä½¿ç”¨è¯´æ˜ : 1:MCUä¸»åŠ¨è°ƒç”¨
 329                     2:æˆåŠŸå,å¯åˆ¤æ–­set_wifi_config_stateæ˜¯å¦ä¸ºTRUE;TRUEè¡¨ç¤ºä¸ºè®¾ç½®wifiå·¥ä½œæ¨¡å¼æˆå
             -ŠŸ
 330                     3:å¦‚æœä¸ºæ¨¡å—è‡ªå¤„ç†æ¨¡å¼,MCUæ— é¡»è°ƒç”¨è¯¥å‡½æ•°
 331          *****************************************************************************/
 332          void mcu_set_wifi_mode(unsigned char mode)
 333          {
 334   1        unsigned char length = 0;
 335   1        
 336   1        set_wifimode_flag = SET_WIFICONFIG_ERROR;
 337   1        
 338   1        length = set_wifi_uart_byte(length, mode);
 339   1        
 340   1        wifi_uart_write_frame(WIFI_MODE_CMD, length);
 341   1      }
 342          /*****************************************************************************
 343          å‡½æ•°åç§° : mcu_get_wifi_work_state
 344          åŠŸèƒ½æè¿° : MCUä¸»åŠ¨è·å–å½“å‰wifiå·¥ä½œçŠ¶æ€
 345          è¾“å…¥å‚æ•° : æ— 
 346          è¿”å›å‚æ•° : WIFI_WORK_SATE_E:
 347                                      SMART_CONFIG_STATE: smartconfig é…ç½®çŠ¶æ€ é—´éš”é—ªçƒ250ms
 348                                                AP_STATE: AP          é…ç½®çŠ¶æ€ é—´éš”é—ªçƒ1500ms
 349                                      WIFI_NOT_CONNECTED: WIFI        é…ç½®æˆåŠŸä½†æœªè¿ä¸Šè·¯ç”±å™¨ é•¿æš—
 350                                          WIFI_CONNECTED: WIFI        é…ç½®æˆåŠŸä¸”è¿ä¸Šè·¯ç”±å™¨ é•¿äº®
 351                                         WIFI_CONN_CLOUD: WIFI        å·²ç»è¿æ¥ä¸Šäº‘æœåŠ¡å™¨ é•¿äº®
 352                                          WIFI_LOW_POWER: WIFI        å¤„äºä½åŠŸè€—æ¨¡å¼ é•¿æš—
 353          ä½¿ç”¨è¯´æ˜ : æ— 
 354          *****************************************************************************/
 355          unsigned char mcu_get_wifi_work_state(void)
 356          {
 357   1        return wifi_work_state;
 358   1      }
 359          #endif
 360          
 361          #ifdef SUPPORT_GREEN_TIME
              /*****************************************************************************
C51 COMPILER V9.57.0.0   MCU_API                                                           05/29/2020 17:28:11 PAGE 7   

              å‡½æ•°åç§°  : mcu_get_green_time
              åŠŸèƒ½æè¿° : MCUè·å–æ ¼æ—æ—¶é—´
              è¾“å…¥å‚æ•° : æ— 
              è¿”å›å‚æ•° : æ— 
              ä½¿ç”¨è¯´æ˜ : 
              *****************************************************************************/
              void mcu_get_green_time(void)
              {
                wifi_uart_write_frame(GET_ONLINE_TIME_CMD,0);
              }
              #endif
 374          
 375          #ifdef SUPPORT_MCU_RTC_CHECK
              /*****************************************************************************
              å‡½æ•°åç§°  : mcu_get_system_time
              åŠŸèƒ½æè¿° : MCUè·å–ç³»ç»Ÿæ—¶é—´,ç”¨äºæ ¡å¯¹æœ¬åœ°æ—¶é’Ÿ
              è¾“å…¥å‚æ•° : æ— 
              è¿”å›å‚æ•° : æ— 
              ä½¿ç”¨è¯´æ˜ : MCUä¸»åŠ¨è°ƒç”¨å®Œæˆååœ¨mcu_write_rtctimeå‡½æ•°å†…æ ¡å¯¹rtcæ—¶é’Ÿ
              *****************************************************************************/
              void mcu_get_system_time(void)
              {
                wifi_uart_write_frame(GET_LOCAL_TIME_CMD,0);
              }
              #endif
 388          
 389          #ifdef WIFI_TEST_ENABLE
 390          /*****************************************************************************
 391          å‡½æ•°åç§° : mcu_start_wifitest
 392          åŠŸèƒ½æè¿° : mcuå‘èµ·wifiåŠŸèƒ½æµ‹è¯•ï¼ˆæ‰«ææŒ‡å®šè·¯ç”±ï¼‰
 393          è¾“å…¥å‚æ•° : æ— 
 394          è¿”å›å‚æ•° : æ— 
 395          ä½¿ç”¨è¯´æ˜ : MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
 396          *****************************************************************************/
 397          void mcu_start_wifitest(void)
 398          {
 399   1        wifi_uart_write_frame(WIFI_TEST_CMD,0);
 400   1      }
 401          #endif
 402          
 403          #ifdef WIFI_CONNECT_TEST_ENABLE
              /*****************************************************************************
              å‡½æ•°åç§° : mcu_start_connect_wifitest
              åŠŸèƒ½æè¿° : mcuå‘èµ·wifiåŠŸèƒ½æµ‹è¯•(è¿æ¥æŒ‡å®šè·¯ç”±)
              è¾“å…¥å‚æ•° : ssid_buf:å­˜æ”¾è·¯ç”±å™¨åç§°å­—ç¬¦ä¸²æ•°æ®çš„åœ°å€(ssidé•¿åº¦æœ€å¤§æ”¯æŒ32ä¸ªå­—èŠ‚)
                         passwd_buffer:å­˜æ”¾è·¯ç”±å™¨åç§°å­—ç¬¦ä¸²æ•°æ®çš„åœ°å€(passwdé•¿åº¦æœ€å¤§æ”¯æŒ64ä¸ªå­—èŠ‚
             -)
              è¿”å›å‚æ•° : æ— 
              ä½¿ç”¨è¯´æ˜ : MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
              *****************************************************************************/
              void mcu_start_connect_wifitest(unsigned char *ssid_buf,unsigned char *passwd_buffer)
              {
                unsigned short length = 0;
              
                if( my_strlen(ssid_buf) > 32 || my_strlen(passwd_buffer) > 64) {
                  //printf("ssid_buf or passwd_buffer is too long!");
                  return;
                }
                
                length = set_wifi_uart_buffer(length, "{\"ssid\":\"", my_strlen("{\"ssid\":\""));
                length = set_wifi_uart_buffer(length,ssid_buf,my_strlen(ssid_buf));
                length = set_wifi_uart_buffer(length, "\",\"password\":\"", my_strlen("\",\"password\":\""));
C51 COMPILER V9.57.0.0   MCU_API                                                           05/29/2020 17:28:11 PAGE 8   

                length = set_wifi_uart_buffer(length,passwd_buffer,my_strlen(passwd_buffer));
                length = set_wifi_uart_buffer(length, "\"}", my_strlen("\"}"));
              
                wifi_uart_write_frame(WIFI_CONNECT_TEST_CMD,length);
              }
              #endif
 430          
 431          
 432          #ifdef WIFI_HEARTSTOP_ENABLE
 433          /*****************************************************************************
 434          å‡½æ•°åç§° : wifi_heart_stop
 435          åŠŸèƒ½æè¿° : é€šçŸ¥WIFIæ¨¡ç»„å…³é—­å¿ƒè·³
 436          è¾“å…¥å‚æ•° : æ— 
 437          è¿”å›å‚æ•° : æ— 
 438          *****************************************************************************/
 439          void wifi_heart_stop(void)
 440          {
 441   1        wifi_uart_write_frame(HEAT_BEAT_STOP,0);
 442   1      }
 443          #endif
 444          
 445          #ifdef GET_WIFI_STATUS_ENABLE
              /*****************************************************************************
              å‡½æ•°åç§° : mcu_get_wifi_connect_status
              
              åŠŸèƒ½æè¿° : è·å–å½“å‰wifiè”ç½‘çŠ¶æ€
              è¾“å…¥å‚æ•° : æ— 
              è¿”å›å‚æ•° : æ— 
              ä½¿ç”¨è¯´æ˜ : MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
              *****************************************************************************/
              void mcu_get_wifi_connect_status(void)
              {
                wifi_uart_write_frame(GET_WIFI_STATUS_CMD,0);
              }
              #endif
 459          
 460          #ifdef GET_MODULE_MAC_ENABLE
              /*****************************************************************************
              å‡½æ•°åç§° : mcu_get_module_mac
              
              åŠŸèƒ½æè¿° : è·å–æ¨¡å—MAC
              è¾“å…¥å‚æ•° : æ— 
              è¿”å›å‚æ•° : æ— 
              ä½¿ç”¨è¯´æ˜ : MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
              *****************************************************************************/
              void mcu_get_module_mac(void)
              {
                wifi_uart_write_frame(GET_MAC_CMD,0);
              }
              #endif
 474          
 475          /*****************************************************************************
 476          å‡½æ•°åç§° : mcu_dp_raw_update
 477          åŠŸèƒ½æè¿° : rawå‹dpæ•°æ®ä¸Šä¼ 
 478          è¾“å…¥å‚æ•° : dpid:idå·
 479                     value:å½“å‰dpå€¼æŒ‡é’ˆ
 480                     len:æ•°æ®é•¿åº¦
 481          è¿”å›å‚æ•° : æ— 
 482          *****************************************************************************/
 483          unsigned char mcu_dp_raw_update(unsigned char dpid,const unsigned char value[],unsigned short len)
 484          {
 485   1        unsigned short length = 0;
C51 COMPILER V9.57.0.0   MCU_API                                                           05/29/2020 17:28:11 PAGE 9   

 486   1        
 487   1        if(stop_update_flag == ENABLE)
 488   1          return SUCCESS;
 489   1        //
 490   1        length = set_wifi_uart_byte(length,dpid);
 491   1        length = set_wifi_uart_byte(length,DP_TYPE_RAW);
 492   1        //
 493   1        length = set_wifi_uart_byte(length,len / 0x100);
 494   1        length = set_wifi_uart_byte(length,len % 0x100);
 495   1        //
 496   1        length = set_wifi_uart_buffer(length,(unsigned char *)value,len);
 497   1        
 498   1        wifi_uart_write_frame(STATE_UPLOAD_CMD,length);
 499   1        
 500   1        return SUCCESS;
 501   1      }
 502          /*****************************************************************************
 503          å‡½æ•°åç§° : mcu_dp_bool_update
 504          åŠŸèƒ½æè¿° : boolå‹dpæ•°æ®ä¸Šä¼ 
 505          è¾“å…¥å‚æ•° : dpid:idå·
 506                     value:å½“å‰dpå€¼
 507          è¿”å›å‚æ•° : æ— 
 508          *****************************************************************************/
 509          unsigned char mcu_dp_bool_update(unsigned char dpid,unsigned char value)
 510          {
 511   1        unsigned short length = 0;
 512   1        
 513   1        if(stop_update_flag == ENABLE)
 514   1          return SUCCESS;
 515   1        
 516   1        length = set_wifi_uart_byte(length,dpid);
 517   1        length = set_wifi_uart_byte(length,DP_TYPE_BOOL);
 518   1        //
 519   1        length = set_wifi_uart_byte(length,0);
 520   1        length = set_wifi_uart_byte(length,1);
 521   1        //
 522   1        if(value == FALSE)
 523   1        {
 524   2          length = set_wifi_uart_byte(length,FALSE);
 525   2        }
 526   1        else
 527   1        {
 528   2          length = set_wifi_uart_byte(length,1);
 529   2        }
 530   1        
 531   1        wifi_uart_write_frame(STATE_UPLOAD_CMD,length);
 532   1        
 533   1        return SUCCESS;
 534   1      }
 535          /*****************************************************************************
 536          å‡½æ•°åç§° : mcu_dp_value_update
 537          åŠŸèƒ½æè¿° : valueå‹dpæ•°æ®ä¸Šä¼ 
 538          è¾“å…¥å‚æ•° : dpid:idå·
 539                     value:å½“å‰dpå€¼ 32bits
 540          è¿”å›å‚æ•° : æ— 
 541          *****************************************************************************/
 542          unsigned char mcu_dp_value_update(unsigned char dpid,unsigned long value)
 543          {
 544   1        unsigned short length = 0;
 545   1        
 546   1        if(stop_update_flag == ENABLE)
 547   1          return SUCCESS;
C51 COMPILER V9.57.0.0   MCU_API                                                           05/29/2020 17:28:11 PAGE 10  

 548   1        
 549   1        length = set_wifi_uart_byte(length,dpid);
 550   1        length = set_wifi_uart_byte(length,DP_TYPE_VALUE);
 551   1        // 
 552   1        length = set_wifi_uart_byte(length,0);
 553   1        length = set_wifi_uart_byte(length,4);
 554   1        // 
 555   1        length = set_wifi_uart_byte(length,value >> 24);
 556   1        length = set_wifi_uart_byte(length,value >> 16);
 557   1        length = set_wifi_uart_byte(length,value >> 8);
 558   1        length = set_wifi_uart_byte(length,value & 0xff);
 559   1        
 560   1        wifi_uart_write_frame(STATE_UPLOAD_CMD,length);
 561   1        
 562   1        return SUCCESS;
 563   1      }
 564          /*****************************************************************************
 565          å‡½æ•°åç§° : mcu_dp_string_update
 566          åŠŸèƒ½æè¿° : rstringå‹dpæ•°æ®ä¸Šä¼ 
 567          è¾“å…¥å‚æ•° : dpid:idå·
 568                     value:å½“å‰dpå€¼æŒ‡é’ˆ
 569                     len:æ•°æ®é•¿åº¦
 570          è¿”å›å‚æ•° : æ— 
 571          *****************************************************************************/
 572          unsigned char mcu_dp_string_update(unsigned char dpid,const unsigned char value[],unsigned short len)
 573          {
 574   1        unsigned short length = 0;
 575   1        
 576   1        if(stop_update_flag == ENABLE)
 577   1          return SUCCESS;
 578   1        // 
 579   1        length = set_wifi_uart_byte(length,dpid);
 580   1        length = set_wifi_uart_byte(length,DP_TYPE_STRING);
 581   1        //
 582   1        length = set_wifi_uart_byte(length,len / 0x100);
 583   1        length = set_wifi_uart_byte(length,len % 0x100);
 584   1        // 
 585   1        length = set_wifi_uart_buffer(length,(unsigned char *)value,len);
 586   1        
 587   1        wifi_uart_write_frame(STATE_UPLOAD_CMD,length);
 588   1        
 589   1        return SUCCESS;
 590   1      }
 591          /*****************************************************************************
 592          å‡½æ•°åç§° : mcu_dp_enum_update
 593          åŠŸèƒ½æè¿° : enumå‹dpæ•°æ®ä¸Šä¼ 
 594          è¾“å…¥å‚æ•° : dpid:idå·
 595                     value:å½“å‰dpå€¼
 596          è¿”å›å‚æ•° : æ— 
 597          *****************************************************************************/
 598          unsigned char mcu_dp_enum_update(unsigned char dpid,unsigned char value)
 599          {
 600   1        unsigned short length = 0;
 601   1        
 602   1        if(stop_update_flag == ENABLE)
 603   1          return SUCCESS;
 604   1      
 605   1        length = set_wifi_uart_byte(length,dpid);
 606   1        length = set_wifi_uart_byte(length,DP_TYPE_ENUM);
 607   1        //
 608   1        length = set_wifi_uart_byte(length,0);
 609   1        length = set_wifi_uart_byte(length,1);
C51 COMPILER V9.57.0.0   MCU_API                                                           05/29/2020 17:28:11 PAGE 11  

 610   1        //
 611   1        length = set_wifi_uart_byte(length,value);
 612   1        
 613   1        wifi_uart_write_frame(STATE_UPLOAD_CMD,length);
 614   1        
 615   1        return SUCCESS;
 616   1      }
 617          /*****************************************************************************
 618          å‡½æ•°åç§° : mcu_dp_fault_update
 619          åŠŸèƒ½æè¿° : faultå‹dpæ•°æ®ä¸Šä¼ 
 620          è¾“å…¥å‚æ•° : dpid:idå·
 621                     value:å½“å‰dpå€¼
 622          è¿”å›å‚æ•° : æ— 
 623          *****************************************************************************/
 624          unsigned char mcu_dp_fault_update(unsigned char dpid,unsigned long value)
 625          {
 626   1        unsigned short length = 0;
 627   1         
 628   1        if(stop_update_flag == ENABLE)
 629   1          return SUCCESS;
 630   1        
 631   1        length = set_wifi_uart_byte(length,dpid);
 632   1        length = set_wifi_uart_byte(length,DP_TYPE_FAULT);
 633   1        //
 634   1        length = set_wifi_uart_byte(length,0);
 635   1        
 636   1        if((value | 0xff) == 0xff)
 637   1        {
 638   2          length = set_wifi_uart_byte(length,1);
 639   2          length = set_wifi_uart_byte(length,value);
 640   2        }
 641   1        else if((value | 0xffff) == 0xffff)
 642   1        {
 643   2          length = set_wifi_uart_byte(length,2);
 644   2          length = set_wifi_uart_byte(length,value >> 8);
 645   2          length = set_wifi_uart_byte(length,value & 0xff);
 646   2        }
 647   1        else
 648   1        {
 649   2          length = set_wifi_uart_byte(length,4);
 650   2          length = set_wifi_uart_byte(length,value >> 24);
 651   2          length = set_wifi_uart_byte(length,value >> 16);
 652   2          length = set_wifi_uart_byte(length,value >> 8);
 653   2          length = set_wifi_uart_byte(length,value & 0xff);
 654   2        }    
 655   1        
 656   1        wifi_uart_write_frame(STATE_UPLOAD_CMD,length);
 657   1      
 658   1        return SUCCESS;
 659   1      }
 660          
 661          #ifdef MCU_DP_UPLOAD_SYN
                /*****************************************************************************
                å‡½æ•°åç§° : mcu_dp_raw_update_syn
                åŠŸèƒ½æè¿° : rawå‹dpæ•°æ®åŒæ­¥ä¸Šä¼ 
                è¾“å…¥å‚æ•° : dpid:idå·
                           value:å½“å‰dpå€¼æŒ‡é’ˆ
                           len:æ•°æ®é•¿åº¦
                è¿”å›å‚æ•° : æ— 
                *****************************************************************************/
                unsigned char mcu_dp_raw_update_syn(unsigned char dpid,const unsigned char value[],unsigned short len)
                {
C51 COMPILER V9.57.0.0   MCU_API                                                           05/29/2020 17:28:11 PAGE 12  

                  unsigned short length = 0;
                  
                  if(stop_update_flag == ENABLE)
                    return SUCCESS;
                  //
                  length = set_wifi_uart_byte(length,dpid);
                  length = set_wifi_uart_byte(length,DP_TYPE_RAW);
                  //
                  length = set_wifi_uart_byte(length,len / 0x100);
                  length = set_wifi_uart_byte(length,len % 0x100);
                  //
                  length = set_wifi_uart_buffer(length,(unsigned char *)value,len);
                  
                  wifi_uart_write_frame(STATE_UPLOAD_SYN_CMD,length);
                  
                  return SUCCESS;
                }
                /*****************************************************************************
                å‡½æ•°åç§° : mcu_dp_bool_update_syn
                åŠŸèƒ½æè¿° : boolå‹dpæ•°æ®åŒæ­¥ä¸Šä¼ 
                è¾“å…¥å‚æ•° : dpid:idå·
                           value:å½“å‰dpå€¼
                è¿”å›å‚æ•° : æ— 
                *****************************************************************************/
                unsigned char mcu_dp_bool_update_syn(unsigned char dpid,unsigned char value)
                {
                  unsigned short length = 0;
                  
                  if(stop_update_flag == ENABLE)
                    return SUCCESS;
                  
                  length = set_wifi_uart_byte(length,dpid);
                  length = set_wifi_uart_byte(length,DP_TYPE_BOOL);
                  //
                  length = set_wifi_uart_byte(length,0);
                  length = set_wifi_uart_byte(length,1);
                  //
                  if(value == FALSE)
                  {
                    length = set_wifi_uart_byte(length,FALSE);
                  }
                  else
                  {
                    length = set_wifi_uart_byte(length,1);
                  }
                  
                  wifi_uart_write_frame(STATE_UPLOAD_SYN_CMD,length);
                  
                  return SUCCESS;
                }
                /*****************************************************************************
                å‡½æ•°åç§° : mcu_dp_value_update_syn
                åŠŸèƒ½æè¿° : valueå‹dpæ•°æ®åŒæ­¥ä¸Šä¼ 
                è¾“å…¥å‚æ•° : dpid:idå·
                           value:å½“å‰dpå€¼
                è¿”å›å‚æ•° : æ— 
                *****************************************************************************/
                unsigned char mcu_dp_value_update_syn(unsigned char dpid,unsigned long value)
                {
                  unsigned short length = 0;
                  
                  if(stop_update_flag == ENABLE)
C51 COMPILER V9.57.0.0   MCU_API                                                           05/29/2020 17:28:11 PAGE 13  

                    return SUCCESS;
                  
                  length = set_wifi_uart_byte(length,dpid);
                  length = set_wifi_uart_byte(length,DP_TYPE_VALUE);
                  //
                  length = set_wifi_uart_byte(length,0);
                  length = set_wifi_uart_byte(length,4);
                  //
                  length = set_wifi_uart_byte(length,value >> 24);
                  length = set_wifi_uart_byte(length,value >> 16);
                  length = set_wifi_uart_byte(length,value >> 8);
                  length = set_wifi_uart_byte(length,value & 0xff);
                  
                  wifi_uart_write_frame(STATE_UPLOAD_SYN_CMD,length);
                  
                  return SUCCESS;
                }
                /*****************************************************************************
                å‡½æ•°åç§° : mcu_dp_string_update_syn
                åŠŸèƒ½æè¿° : rstringå‹dpæ•°æ®åŒæ­¥ä¸Šä¼ 
                è¾“å…¥å‚æ•° : dpid:idå·
                           value:å½“å‰dpå€¼æŒ‡é’ˆ
                           len:æ•°æ®é•¿åº¦
                è¿”å›å‚æ•° : æ— 
                *****************************************************************************/
                unsigned char mcu_dp_string_update_syn(unsigned char dpid,const unsigned char value[],unsigned short len
             -)
                {
                  unsigned short length = 0;
                  
                  if(stop_update_flag == ENABLE)
                    return SUCCESS;
                  //
                  length = set_wifi_uart_byte(length,dpid);
                  length = set_wifi_uart_byte(length,DP_TYPE_STRING);
                  //
                  length = set_wifi_uart_byte(length,len / 0x100);
                  length = set_wifi_uart_byte(length,len % 0x100);
                  //
                  length = set_wifi_uart_buffer(length,(unsigned char *)value,len);
                  
                  wifi_uart_write_frame(STATE_UPLOAD_SYN_CMD,length);
                  
                  return SUCCESS;
                }
                /*****************************************************************************
                å‡½æ•°åç§° : mcu_dp_enum_update_syn
                åŠŸèƒ½æè¿° : enumå‹dpæ•°æ®åŒæ­¥ä¸Šä¼ 
                è¾“å…¥å‚æ•° : dpid:idå·
                           value:å½“å‰dpå€¼
                è¿”å›å‚æ•° : æ— 
                *****************************************************************************/
                unsigned char mcu_dp_enum_update_syn(unsigned char dpid,unsigned char value)
                {
                  unsigned short length = 0;
                  
                  if(stop_update_flag == ENABLE)
                    return SUCCESS;
                  
                  length = set_wifi_uart_byte(length,dpid);
                  length = set_wifi_uart_byte(length,DP_TYPE_ENUM);
                  //
C51 COMPILER V9.57.0.0   MCU_API                                                           05/29/2020 17:28:11 PAGE 14  

                  length = set_wifi_uart_byte(length,0);
                  length = set_wifi_uart_byte(length,1);
                  //
                  length = set_wifi_uart_byte(length,value);
                  
                  wifi_uart_write_frame(STATE_UPLOAD_SYN_CMD,length);
                  
                  return SUCCESS;
                }
                /*****************************************************************************
                å‡½æ•°åç§° : mcu_dp_fault_update_syn
                åŠŸèƒ½æè¿° : faultå‹dpæ•°æ®åŒæ­¥ä¸Šä¼ 
                è¾“å…¥å‚æ•° : dpid:idå·
                           value:å½“å‰dpå€¼
                è¿”å›å‚æ•° : æ— 
                *****************************************************************************/
                unsigned char mcu_dp_fault_update_syn(unsigned char dpid,unsigned long value)
                {
                  unsigned short length = 0;
                   
                  if(stop_update_flag == ENABLE)
                    return SUCCESS;
                  
                  length = set_wifi_uart_byte(length,dpid);
                  length = set_wifi_uart_byte(length,DP_TYPE_FAULT);
                  //
                  length = set_wifi_uart_byte(length,0);
                  
                  if((value | 0xff) == 0xff)
                  {
                    length = set_wifi_uart_byte(length,1);
                    length = set_wifi_uart_byte(length,value);
                  }
                  else if((value | 0xffff) == 0xffff)
                  {
                    length = set_wifi_uart_byte(length,2);
                    length = set_wifi_uart_byte(length,value >> 8);
                    length = set_wifi_uart_byte(length,value & 0xff);
                  }
                  else
                  {
                    length = set_wifi_uart_byte(length,4);
                    length = set_wifi_uart_byte(length,value >> 24);
                    length = set_wifi_uart_byte(length,value >> 16);
                    length = set_wifi_uart_byte(length,value >> 8);
                    length = set_wifi_uart_byte(length,value & 0xff);
                  }    
                  
                  wifi_uart_write_frame(STATE_UPLOAD_SYN_CMD,length);
                
                  return SUCCESS;
                }
              #endif
 848          
 849          /*****************************************************************************
 850          å‡½æ•°åç§° : mcu_get_dp_download_bool
 851          åŠŸèƒ½æè¿° : mcuè·å–boolå‹ä¸‹å‘dpå€¼
 852          è¾“å…¥å‚æ•° : value:dpæ•°æ®ç¼“å†²åŒºåœ°å€
 853                     length:dpæ•°æ®é•¿åº¦
 854          è¿”å›å‚æ•° : bool:å½“å‰dpå€¼
 855          *****************************************************************************/
 856          unsigned char mcu_get_dp_download_bool(const unsigned char value[],unsigned short len)
C51 COMPILER V9.57.0.0   MCU_API                                                           05/29/2020 17:28:11 PAGE 15  

 857          {
 858   1        return(value[0]);
 859   1      }
*** WARNING C280 IN LINE 856 OF ..\User\AppCode\WIFILayer\mcu_api.c: 'len': unreferenced local variable
 860          /*****************************************************************************
 861          å‡½æ•°åç§° : mcu_get_dp_download_enum
 862          åŠŸèƒ½æè¿° : mcuè·å–enumå‹ä¸‹å‘dpå€¼
 863          è¾“å…¥å‚æ•° : value:dpæ•°æ®ç¼“å†²åŒºåœ°å€
 864                     length:dpæ•°æ®é•¿åº¦
 865          è¿”å›å‚æ•° : enum:å½“å‰dpå€¼
 866          *****************************************************************************/
 867          unsigned char mcu_get_dp_download_enum(const unsigned char value[],unsigned short len)
 868          {
 869   1        return(value[0]);
 870   1      }
*** WARNING C280 IN LINE 867 OF ..\User\AppCode\WIFILayer\mcu_api.c: 'len': unreferenced local variable
 871          /*****************************************************************************
 872          å‡½æ•°åç§° : mcu_get_dp_download_value
 873          åŠŸèƒ½æè¿° : mcuè·å–valueå‹ä¸‹å‘dpå€¼
 874          è¾“å…¥å‚æ•° : value:dpæ•°æ®ç¼“å†²åŒºåœ°å€
 875                     length:dpæ•°æ®é•¿åº¦
 876          è¿”å›å‚æ•° : value:å½“å‰dpå€¼
 877          *****************************************************************************/
 878          unsigned long mcu_get_dp_download_value(const unsigned char value[],unsigned short len)
 879          {
 880   1        return(byte_to_int(value));
 881   1      }
*** WARNING C280 IN LINE 878 OF ..\User\AppCode\WIFILayer\mcu_api.c: 'len': unreferenced local variable
 882          /*****************************************************************************
 883          å‡½æ•°åç§° : uart_receive_input
 884          åŠŸèƒ½æè¿° : æ”¶æ•°æ®å¤„ç†
 885          è¾“å…¥å‚æ•° : value:ä¸²å£æ”¶åˆ°å­—èŠ‚æ•°æ®
 886          è¿”å›å‚æ•° : æ— 
 887          ä½¿ç”¨è¯´æ˜ : åœ¨MCUä¸²å£æ¥æ”¶å‡½æ•°ä¸­è°ƒç”¨è¯¥å‡½æ•°,å¹¶å°†æ¥æ”¶åˆ°çš„æ•°æ®ä½œä¸ºå‚æ•°ä¼ å…¥
 888          *****************************************************************************/
 889          void uart_receive_input(unsigned char value)
 890          {
 891   1      //  #error "è¯·åœ¨ä¸²å£æ¥æ”¶ä¸­æ–­ä¸­è°ƒç”¨uart_receive_input(value),ä¸²å£æ•°æ®ç”±MCU_SDKå¤„ç†,ç”¨æˆ·
             -è¯·å‹¿å†å¦è¡Œå¤„ç†,å®Œæˆååˆ é™¤è¯¥è¡Œ" 
 892   1      
 893   1        if((queue_in > queue_out) && ((queue_in - queue_out) >= sizeof(wifi_queue_buf)))
 894   1        {
 895   2          // æ•°æ®é˜Ÿåˆ—æ»¡
 896   2        }
 897   1        else if((queue_in < queue_out) && ((queue_out  - queue_in) == 0))
 898   1        {
 899   2          // æ•°æ®é˜Ÿåˆ—æ»¡
 900   2        }
 901   1        else
 902   1        {
 903   2          // é˜Ÿåˆ—ä¸æ»¡
 904   2          if(queue_in >= (unsigned char *)(wifi_queue_buf + sizeof(wifi_queue_buf)))
 905   2          {
 906   3            queue_in = (unsigned char *)(wifi_queue_buf);
 907   3          }
 908   2          
 909   2          *queue_in ++ = value;
 910   2        }
 911   1      }
 912          /*****************************************************************************
 913          å‡½æ•°åç§°  : wifi_uart_service
 914          åŠŸèƒ½æè¿°  : wifiä¸²å£å¤„ç†æœåŠ¡
C51 COMPILER V9.57.0.0   MCU_API                                                           05/29/2020 17:28:11 PAGE 16  

 915          è¾“å…¥å‚æ•° : æ— 
 916          è¿”å›å‚æ•° : æ— 
 917          ä½¿ç”¨è¯´æ˜ : åœ¨MCUä¸»å‡½æ•°whileå¾ªç¯ä¸­è°ƒç”¨è¯¥å‡½æ•°
 918          *****************************************************************************/
 919          void wifi_uart_service(void)
 920          {
 921   1      //  #error "è¯·ç›´æ¥åœ¨mainå‡½æ•°çš„while(1){}ä¸­æ·»åŠ wifi_uart_service(),è°ƒç”¨è¯¥å‡½æ•°ä¸è¦åŠ ä»»ä½•
             -æ¡ä»¶åˆ¤æ–­,å®Œæˆååˆ é™¤è¯¥è¡Œ" 
 922   1        static unsigned short rx_in = 0;
 923   1        unsigned short offset = 0;
 924   1        unsigned short rx_value_len = 0;             //æ•°æ®å¸§é•¿åº¦
 925   1        
 926   1        while((rx_in < sizeof(wifi_uart_rx_buf)) && get_queue_total_data() > 0)
 927   1        {
 928   2          wifi_uart_rx_buf[rx_in ++] = Queue_Read_Byte();
 929   2        }
 930   1        
 931   1        if(rx_in < PROTOCOL_HEAD)     return;                                         // å¦‚æœæ”¶åˆ°çš„æ•°æ®ä¸ªæ•°å°äº7ä¸ª
 932   1        
 933   1        while((rx_in - offset) >= PROTOCOL_HEAD)
 934   1        {
 935   2          if(wifi_uart_rx_buf[offset + HEAD_FIRST] != FRAME_FIRST)
 936   2          {
 937   3            offset ++;
 938   3            continue;
 939   3          }
 940   2          
 941   2          if(wifi_uart_rx_buf[offset + HEAD_SECOND] != FRAME_SECOND)
 942   2          {
 943   3            offset ++;
 944   3            continue;
 945   3          }  
 946   2          
 947   2          if(wifi_uart_rx_buf[offset + PROTOCOL_VERSION] != VERSION)
 948   2          {
 949   3            offset += 2;
 950   3            continue;
 951   3          }      
 952   2          
 953   2          rx_value_len = wifi_uart_rx_buf[offset + LENGTH_HIGH] * 0x100;
 954   2          rx_value_len += (wifi_uart_rx_buf[offset + LENGTH_LOW] + PROTOCOL_HEAD);
 955   2      
 956   2          if(rx_value_len > sizeof(wifi_uart_rx_buf) + PROTOCOL_HEAD)
 957   2          {
 958   3            offset += 3;
 959   3            continue;
 960   3          }
 961   2      
 962   2              // å¦‚æœæ”¶åˆ°çš„æ•°æ®é•¿åº¦å°äºæ€»é•¿åº¦ï¼Œå³æ”¶åˆ°çš„æ•°æ®æœ‰è¯¯
 963   2          if((rx_in - offset) < rx_value_len)
 964   2          {
 965   3            break;
 966   3          }
 967   2          
 968   2          //æ•°æ®æ¥æ”¶å®Œæˆ
 969   2          if(get_check_sum((unsigned char *)wifi_uart_rx_buf + offset,rx_value_len - 1) != wifi_uart_rx_buf[offs
             -et + rx_value_len - 1])
 970   2          {
 971   3            //æ ¡éªŒå‡ºé”™
 972   3            offset += 3;
 973   3            continue;
 974   3          }
C51 COMPILER V9.57.0.0   MCU_API                                                           05/29/2020 17:28:11 PAGE 17  

 975   2          
 976   2          data_handle(offset);
 977   2              
 978   2          offset += rx_value_len;
 979   2        }//end while
 980   1      
 981   1        rx_in -= offset;
 982   1        
 983   1        if(rx_in > 0)
 984   1        {
 985   2          my_memcpy((char *)wifi_uart_rx_buf,(const char *)wifi_uart_rx_buf + offset,rx_in);
 986   2        }
 987   1      }
 988          
 989          /*****************************************************************************
 990          å‡½æ•°åç§° : wifi_protocol_init
 991          åŠŸèƒ½æè¿° : åè®®ä¸²å£åˆå§‹åŒ–å‡½æ•°
 992          è¾“å…¥å‚æ•° : æ— 
 993          è¿”å›å‚æ•° : æ— 
 994          ä½¿ç”¨è¯´æ˜ : å¿…é¡»åœ¨MCUåˆå§‹åŒ–ä»£ç ä¸­è°ƒç”¨è¯¥å‡½æ•°
 995          *****************************************************************************/
 996          void wifi_protocol_init(void)
 997          {
 998   1      //  #error " è¯·åœ¨mainå‡½æ•°ä¸­æ·»åŠ wifi_protocol_init()å®Œæˆwifiåè®®åˆå§‹åŒ–,å¹¶åˆ é™¤è¯¥è¡Œ"
 999   1        queue_in = (unsigned char *)wifi_queue_buf;
1000   1        queue_out = (unsigned char *)wifi_queue_buf;
1001   1        //
1002   1      #ifndef WIFI_CONTROL_SELF_MODE
1003   1        wifi_work_state = WIFI_SATE_UNKNOW;
1004   1      #endif
1005   1      }
1006          
1007          #ifdef WIFI_STREAM_ENABLE
              /*****************************************************************************
              å‡½æ•°åç§° : stream_trans 
              åŠŸèƒ½æè¿° : æµæ•°æ®ä¼ è¾“
              è¾“å…¥å‚æ•° : id:æµæœåŠ¡æ ‡è¯†;offset:åç§»é‡;buffer:æ•°æ®åœ°å€;buf_len:æ•°æ®é•¿åº¦
              è¿”å›å‚æ•° : æ— 
              *****************************************************************************/
              unsigned char stream_trans(unsigned short id, unsigned int offset, unsigned char *buffer, unsigned short b
             -uf_len)
              {
                unsigned short length = 0;
              
                stream_status = 0xff;
              
                if(stop_update_flag == ENABLE)
                  return SUCCESS;
              
                //ID
                length = set_wifi_uart_byte(length,id / 0x100);
                length = set_wifi_uart_byte(length,id % 0x100);
                //åç§»é‡
                length = set_wifi_uart_byte(length,offset >> 24);
                length = set_wifi_uart_byte(length,offset >> 16);
                length = set_wifi_uart_byte(length,offset >> 8);
                length = set_wifi_uart_byte(length,offset % 256);
                //æ•°æ®
                length = set_wifi_uart_buffer(length, buffer, buf_len);
                wifi_uart_write_frame(STREAM_TRANS_CMD, length);
              }
              
C51 COMPILER V9.57.0.0   MCU_API                                                           05/29/2020 17:28:11 PAGE 18  

              #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2990    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      2      95
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  3 WARNING(S),  0 ERROR(S)
